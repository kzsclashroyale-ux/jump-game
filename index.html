<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Jump & Dash – Animowany Gracz</title>
<style>
body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
canvas { display: block; background: #87CEEB; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Gracz ---
let player = { x: 50, y: canvas.height-100, width: 50, height: 50, dy: 0, jumpPower: 18, grounded: true };
let playerName = "Gracz";

// --- Przeszkody ---
let obstacles = [];
let obstacleTimer = 0;
let baseSpeed = 4;

// --- Monety i tarcza ---
let coins = [];
let shields = [];
let shieldActive = false;
let shieldChance = 0.25;

// --- Cząsteczki ---
let particles = [];

// --- Shake ekranu ---
let shakeDuration = 0;
let shakeMagnitude = 10;

// --- Gra ---
let score = 0;
let gameOver = false;
let gameStarted = false;
let leaderboardUpdated = false;

// --- Animacje monet ---
let coinWave = 0;

// --- Chmury parallax ---
let clouds = [];
for (let i = 0; i < 20; i++) {
    clouds.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height/2,
        width: 80 + Math.random()*50,
        height: 40 + Math.random()*20,
        speed: 0.2 + Math.random()*0.5
    });
}

// --- Leaderboard ---
let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
function updateLeaderboard(score) {
    leaderboard.push({name: playerName, score: score});
    leaderboard.sort((a,b)=>b.score - a.score);
    leaderboard = leaderboard.slice(0,5);
    localStorage.setItem('leaderboard', JSON.stringify(leaderboard));
}

// --- Funkcje ---
function getMaxJumpHeight() { return player.jumpPower * player.jumpPower / (2 * 0.6); }
function createParticles(x, y, color) {
    for (let i=0; i<15; i++){
        particles.push({x:x, y:y, dx:(Math.random()-0.5)*6, dy:(Math.random()-1.5)*6, alpha:1, color:color, size:2+Math.random()*3});
    }
}

// --- Sterowanie ---
document.addEventListener('keydown', (e)=>{
    if(e.code==="Space"){
        if(!gameStarted){ 
            playerName = prompt("Wpisz swój nick:", "Gracz") || "Gracz";
            gameStarted=true; 
            return; 
        }
        if(!gameOver && player.grounded){ player.dy=-player.jumpPower; player.grounded=false; }
        else if(gameOver) resetGame();
    }
});

// --- Spawnowanie ---
function spawnObstacle(){ 
    let height=40+Math.random()*30;
    obstacles.push({x:canvas.width, y:canvas.height-height, width:30+Math.random()*20, height:height});
    if(Math.random()<0.4) spawnCoin();
    let chance=(shieldActive||score>=10000)?0:shieldChance;
    if(Math.random()<chance) spawnShield();
}
function spawnCoin(){ 
    let y=canvas.height-player.height-getMaxJumpHeight()+10+Math.random()*20;
    coins.push({x:canvas.width, y:y, size:20, baseY:y});
}
function spawnShield(){ 
    let y=canvas.height-player.height-getMaxJumpHeight()+5;
    shields.push({x:canvas.width, y:y, size:25});
}
function resetGame(){
    obstacles=[]; coins=[]; shields=[]; particles=[];
    player.y=canvas.height-100; player.dy=0;
    score=0; gameOver=false; shieldActive=false; shakeDuration=0; leaderboardUpdated=false;
    clouds.forEach(c=>c.x=Math.random()*canvas.width);
}

// --- Rysowanie ---
function drawClouds(){
    clouds.forEach(c=>{
        c.x-=c.speed;
        if(c.x+c.width<0)c.x=canvas.width+Math.random()*50;
        ctx.fillStyle="rgba(255,255,255,0.8)";
        ctx.beginPath();
        ctx.ellipse(c.x,c.y,c.width,c.height,0,0,Math.PI*2);
        ctx.fill();
    });
}
function drawParticles(){
    for(let i=particles.length-1;i>=0;i--){
        let p=particles[i];
        ctx.fillStyle=`rgba(${p.color},${p.alpha})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
        ctx.fill();
        p.x+=p.dx; p.y+=p.dy; p.alpha-=0.03;
        if(p.alpha<=0) particles.splice(i,1);
    }
}

// --- Update gry ---
function update(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // --- Shake ---
    let shakeX=0, shakeY=0;
    if(shakeDuration>0){ shakeX=(Math.random()-0.5)*shakeMagnitude; shakeY=(Math.random()-0.5)*shakeMagnitude; shakeDuration--; }
    ctx.save(); ctx.translate(shakeX,shakeY);

    // --- Gradient tła ---
    let gradient=ctx.createLinearGradient(0,0,0,canvas.height); 
    gradient.addColorStop(0,"#87CEEB"); 
    gradient.addColorStop(1,"#f0f8ff"); 
    ctx.fillStyle=gradient; ctx.fillRect(0,0,canvas.width,canvas.height);

    drawClouds();
    drawParticles();

    if(!gameStarted){
        ctx.fillStyle="black"; ctx.font="40px Arial"; ctx.fillText("Naciśnij SPACJĘ aby zacząć",canvas.width/2-220,canvas.height/2); 
        ctx.restore(); requestAnimationFrame(update); return;
    }

    if(!gameOver){
        // --- Ruch gracza ---
        player.dy+=0.6;
        player.y+=player.dy;
        if(player.y+player.height>=canvas.height){ player.y=canvas.height-player.height; player.dy=0; player.grounded=true; }

        // --- Rysowanie gracza (animacja) ---
        let stretch = 1;
        if(!player.grounded) stretch = 1 - player.dy/30;
        ctx.save();
        ctx.translate(player.x + player.width/2, player.y + player.height/2);
        ctx.scale(1, stretch);
        ctx.fillStyle="red";
        ctx.fillRect(-player.width/2, -player.height/2, player.width, player.height);
        ctx.restore();

        if(shieldActive){
            ctx.strokeStyle="blue";
            ctx.lineWidth=4;
            ctx.strokeRect(player.x-2, player.y-2, player.width+4, player.height+4);
        }

        // --- Spawnowanie przeszkód ---
        obstacleTimer++;
        if(obstacleTimer>90){ spawnObstacle(); obstacleTimer=0; }

        let speed = baseSpeed + Math.floor(score/500);

        // --- Przeszkody ---
        for(let i=obstacles.length-1;i>=0;i--){
            let obs = obstacles[i];
            obs.x-=speed;
            let wave = Math.sin(Date.now()/200 + obs.x/50)*5;
            ctx.fillStyle="green";
            ctx.fillRect(obs.x, obs.y - wave, obs.width, obs.height + wave);

            if(player.x<obs.x+obs.width && player.x+player.width>obs.x && player.y<obs.y+obs.height && player.y+player.height>obs.y){
                if(shieldActive){ shieldActive=false; obstacles.splice(i,1); createParticles(player.x+player.width/2, player.y+player.height/2,"0,0,255"); }
                else{ gameOver=true; shakeDuration=15; }
            }
            if(obs.x+obs.width<0) obstacles.splice(i,1);
        }

        // --- Monety ---
        coinWave+=0.05;
        for(let i=coins.length-1;i>=0;i--){
            let c = coins[i]; 
            c.x-=speed;
            let yAnim = c.baseY + Math.sin(coinWave + i)*5;

            ctx.save();
            ctx.translate(c.x+c.size/2, yAnim+c.size/2);
            ctx.rotate(Date.now()/300 + i);
            ctx.fillStyle="yellow";
            ctx.beginPath();
            ctx.arc(0,0,c.size/2,0,Math.PI*2);
            ctx.fill();
            ctx.restore();

            if(player.x<c.x+c.size && player.x+player.width>c.x && player.y<yAnim+c.size && player.y+player.height>yAnim){
                coins.splice(i,1);
                score+=50;
                createParticles(c.x+c.size/2,yAnim+c.size/2,"255,255,0");
            }
            if(c.x+c.size<0) coins.splice(i,1);
        }

        // --- Tarcza ---
        for(let i=shields.length-1;i>=0;i--){
            let s = shields[i];
            s.x-=speed;
            let pulse = Math.sin(Date.now()/200)*3;
            ctx.fillStyle="purple";
            ctx.beginPath();
            ctx.arc(s.x+s.size/2, s.y+s.size/2, s.size/2+pulse,0,Math.PI*2);
            ctx.fill();

            if(!shieldActive && player.x<s.x+s.size && player.x+player.width>s.x && player.y<s.y+s.size && player.y+player.height>s.y){
                shieldActive=true;
                shields.splice(i,1);
                createParticles(s.x+s.size/2, s.y+s.size/2,"128,0,128");
            }
            if(s.x+s.size<0) shields.splice(i,1);
        }

        score++;
    }

    // --- Wyświetlanie wyniku ---
    ctx.fillStyle = "black";
    ctx.font = "30px Arial";
    ctx.fillText("Wynik: " + score, 20, 40);

    // --- Game Over ekran ---
    if(gameOver){
        if(!leaderboardUpdated){
            updateLeaderboard(score);
            leaderboardUpdated = true;
        }
        ctx.fillStyle="red";
        ctx.font="50px Arial";
        ctx.fillText("GAME OVER", canvas.width/2-150, canvas.height/2-50);

        ctx.fillStyle="black";
        ctx.font="30px Arial";
        ctx.fillText("Twój wynik: "+score, canvas.width/2-100, canvas.height/2);
        ctx.fillText("Naciśnij SPACJĘ aby zagrać ponownie", canvas.width/2-250, canvas.height/2+50);

        // --- Leaderboard ---
        if(leaderboard.length > 0){
            ctx.fillStyle="black";
            ctx.font="20px Arial";
            ctx.fillText("Najlepsze wyniki:", canvas.width/2-80, canvas.height/2+90);
            for(let i=0; i<leaderboard.length; i++){
                ctx.fillText((i+1)+". "+leaderboard[i].name+" – "+leaderboard[i].score, canvas.width/2-80, canvas.height/2+120 + i*30);
            }
        }
    }

    ctx.restore();
    requestAnimationFrame(update);
}

update();
</script>
</body>
</html>








